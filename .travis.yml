sudo: required
language: c
env:
  global:
    - BROKENDNS=1

install:
  - sudo apt-get update -qq
  - sudo apt-get install -y python-flask doxygen valgrind libpcap-dev python-pip cmake build-essential pkg-config libglib2.0-dev resource-agents python-gi python-netaddr python-demjson openjdk-7-jre
  - sudo -H pip install --upgrade pip
  - sudo -H pip install ctypesgen testify flask getent py2neo
before_script:
  - sudo $TRAVIS_BUILD_DIR/buildtools/ci/install_neo4j
  - sudo $TRAVIS_BUILD_DIR/buildtools/ci/install_libsodium
script:
  - cd $TRAVIS_BUILD_DIR
  - cd ..
  - mkdir root_of_binary_tree
  - cd root_of_binary_tree
  - cmake $TRAVIS_BUILD_DIR
  - sudo make install
  - sudo ldconfig /usr/lib/x86_64-linux-gnu/assimilation
  - sudo cpack
  - sudo dpkg -i *.deb
  - sudo /etc/init.d/nanoprobe stop
  - sudo /etc/init.d/cma stop
  - sudo assimcli genkeys
  - cd $TRAVIS_BUILD_DIR/cma
  - sudo testify -v tests
  - "$TRAVIS_BUILD_DIR/discovery_agents/netconfig"
  - cd $TRAVIS_BUILD_DIR
  - "../root_of_binary_tree/testcode/pinger ::1"

notifications:
  hipchat:
    rooms:
      secure: FkOAzpgsMUtasP5mASMLHcdr0C+y/loW0+MCiD8eWBve14Tthz8681SBncoDqJi5vhOSp50h9e6sP46kmV9RzvD0RAuRv5KRcJRAOLRE5tTwVUUjb4YyV29QRsYv2otj0mjnWfut6x7KFyf3ZDgC4Uwnhj23UEeKZIgPg9ixEiCjiNCG7QbhP44nYwRldpN7lvO5IjbQ9P4po0YPzLdxQf2ffID9NtGoLGNq0bSgvcjjEG0IPPHtDp2Jiv0Sno2ILupwMaMPuItdDQvTgvD7ZreuBzCWiGLBVpdAHIIsVzA1KaW6qHXOtgHPnQkdAlCNuz5u6Sr4PUScEcd5kkdBYR3RKfM3LLhI7AA7LH3TcovY033kH2xtXoTH42R7tW4NN1jlVZDS74tXxXvgv89pi8Q037cqSsuqUMS0Isu9d6BH/VEPHtTS5XmLdKK2tXOaElTCqP7331scJd5SjR6trSC81dFw8lxK+qgUmfi6sapndK/CxOzbJvA+LNmcqYQ0wTMmpFjXA4RaYd5BBhRJNlMPuS4KoVZQa92mShTgp8Z1VvLgICfb8gsNL2GlM0p8ylDURhPZz1A6DsNz+Eozyx8w/3pVXfrMnIrRKA6pYWmMHoynFbWY2+4Sks5rF+6ieMO7Nn1Lm8NdtYqW6SL+SRhehDHy5T8fkZ3hBF6p1m0=
      template:
        - '%{repository}#%{build_number} (%{branch} - %{commit} : %{author}): %{message} (<a href="%{build_url}">Details</a>/<a href="%{compare_url}">Change view</a>)'
        format: html
